# `lattice-sim`

`lattice-sim` is a simulator framework powered by [Stim](https://github.com/quantumlib/Stim). `lattice-sim` supports stabilizer circuits with variable gate latencies and error rates, idling errors, and also incorporates *fenced* and *runahead* policies for instruction scheduling. It also enables the simulation of multiple logical patches. 

## Current limitations

- `lattice-sim` is **NOT** the most optimized tool and takes a significant amount of time for scheduling and determining the logical error rate of stabilizer circuits for large code distances (> 11).
- `lattice-sim` can implement a lattice surgery merge operation between two logical qubits. This functionality is limited, and the merge API needs to be modified to make it more generalized.
- The size and orientations of the patches are constrained - only square patches with the X-boundary on the top and bottom and the Z-boundary on the sides is supported.

## Components

### Gate error and latency

Gate error and latency models are defined in `sim/gate_lib.py`. `lattice-sim` supports various models like fixed, sampled from a gaussian distribution, or sampled from a dataset consisting of errors and latencies from IBM hardware.

### Idling errors

[Pauli twirl approximations](https://journals.aps.org/pra/abstract/10.1103/PhysRevA.86.062318) were used to model idling errors. $T_1$ and $T_2$ times were sampled from an IBM system dataset. This model is also implemented in `sim/gate_lib.py`.

### Circuit generation

The circuit generator is defined in the `circuit` class in `sim/circuit.py`.

### Circuit parser

A simple parser is defined in `sim/circuit_parser.py`. This parser understands circuits described by the OpenQASM standard.

### Stim integration

The circuit generated by the `circuit` class is passed to Stim to get the logical error rate. The `pymatching` decoder is used for decoding errors.

## Usage

### Environment setup

Use the following commands to build and run the Docker container. All python dependencies will be installed within the container.

```bash
docker build -t $USER/lattice-sim .
docker-compose run app
```

### Simulations

`circuit` is the main class of `lattice-sim`. Gate error, latencies, lattice size, number of patches, and the code distance can be specified through this class. An example initialization is shown below:

```python
from sim.circuit import circuit

sim = circuit(distance=3, num_patches_y=20, num_patches_x=20, spacing=1, disable_noise=False, fixed_cnot_latency=100, fixed_measure_latency=500, fixed_cnot_noise=0.001, fixed_measure_noise=0.001, rounds_per_op=d).from_string('qreg q[1];')
```

This initialization creates a Stim compatible stabilizer circuit for a code distance of 3 with fixed CNOT and measurement error rates and latencies. the `from_string()` method is used to specify a QASM circuit to pass to `lattice-sim`.

Lattice surgery between two qubits can be enabled by using the `merge=True` switch in the constructor.
