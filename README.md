# decoder-bench

A benchmarking suite for quantum error correction (QEC) decoders, supporting multiple QEC codes, noise models, and measurement bases. `decoder-bench` generates datasets (in `h5` format) containing check matrices, syndromes, and observables, which can then be used to evaluate any decoder. These datasets can be generated for different noise models (code capacity/phenomenological/circuit-level) for memory experiments and only circuit-level noise for (surface code) Lattice Surgery experiments.

We also include a Sinter-like sampler that can be used for running evaluations for different decoders using the datasets generated by `decoder-bench`. See [Using the datasets](#using-the-datasets).

Future work for this benchmarking suite is to add support for generating decoder traces for more use cases such as transversal operations and color code Lattice Surgery.

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Quick Start](#quick-start)
- [Usage](#usage)
- [Supported Codes](#supported-codes)
- [Noise Models](#noise-models)
- [Examples](#examples)
- [Using the datasets](#using-the-datasets)
- [License](#license)

## Features

- **Multiple Quantum Error Correcting Codes**: Memory experiments (Surface codes, QLDPC codes, Color codes), and Lattice Surgery circuits (only Surface codes, logical measurement operations)
- **Various Noise Models**: Code capacity, phenomenological, and circuit-level noise
- **Flexible Measurement Bases**: Support for both X and Z basis measurements  
- **High-Performance Simulation**: Built on top of [Stim](https://github.com/quantumlib/Stim)
- **Comprehensive Dataset Generation**: Generate large-scale syndrome datasets for decoder training and benchmarking
- **Configurable Parameters**: Adjustable code distances, error rates, and simulation parameters
- **Export Formats**: HDF5 output format for easy data analysis and sharing

## Installation

### Option 1: Install as a Package (Recommended)

```bash
git clone https://github.com/yourusername/decoder-bench.git
cd decoder-bench
pip install -e .
```

### Option 2: Manual Installation

```bash
git clone https://github.com/yourusername/decoder-bench.git
cd decoder-bench
pip install -r requirements.txt
```

### Prerequisites

- Python 3.8 or higher
- Required packages are automatically installed with pip install

## Quick Start

Generate a surface code dataset with circuit-level noise:

```bash
# Using the installed package command
decoder-bench-generate --code=surface --basis=z --noise=circuit -d 9 -p 0.001 --records=10000

# Or run the script directly
python decoder_bench/generator.py --code=surface --basis=z --noise=circuit -d 9 -p 0.001 --records=10000
```

## Usage

### Command Line Interface

The main interface is through the `generator.py` script:

```bash
python decoder_bench/generator.py [OPTIONS]
```

#### Required Arguments

- `--code`: Type of quantum code
  - `surface` - Surface codes with rotated layout
  - `qldpc` - Quantum Low-Density Parity-Check codes  
  - `color` - Color codes
  - `ls` - Lattice Surgery circuits
- `--basis`: Measurement basis (`x` or `z`)
- `--noise`: Noise model (`code_capacity`, `phenom`, or `circuit`)
- `--distance, -d`: Code distance (integer)
- `--depolarization, -p`: Error probability (float)

#### Optional Arguments

- `--iterations`: Maximum iterations (default: 100)
- `--records`: Number of syndrome records to generate (default: 50,000,000)
- `--output-dir`: Output directory for datasets (default: ../datasets)

### Python API

You can also use decoder-bench as a Python package:

```python
import decoder_bench
from decoder_bench.generator import gen_surface_circuit
from decoder_bench.dataset_gen import DatasetGen

# Generate surface code circuit
gen_surface_circuit((distance=7, error_rate=0.001, basis='z'))

# Or use the classes directly
import stim
from decoder_bench.dataset_gen import DatasetGen
from decoder_bench.common.noise import NoiseModel

circuit = stim.Circuit.generated('surface_code:rotated_memory_z', 
                                 distance=7, rounds=7)
circuit = NoiseModel.SI1000(0.001).noisy_circuit(circuit)
generator = DatasetGen(circuit, matchable=True, name='my_dataset')
generator.gen_syndromes(max_iterations=100, num_records=10000)
```

## Supported Codes

### Surface Codes

- **Rotated surface codes** with customizable distance and measurement basis
- Supports X and Z logical measurements
- Multiple noise models available

### QLDPC Codes

- **Bivariate Bicycle codes** with configurable parameters
- Code capacity and circuit-level noise models
- Support for both measurement bases

### Color Codes

- **Triangular lattice color codes**
- Automatic syndrome generation and error correction
- Built-in noise models

### Lattice Surgery

- Only surface codes
- **Multi-patch lattice surgery** simulations
- Variable gate latencies and error rates
- Fenced and runahead instruction scheduling policies
- Merge operations between logical qubits

## Noise Models

### Code Capacity

Perfect syndrome measurements with data qubit errors only.

### Phenomenological

Data qubit errors plus measurement errors, but no circuit-level details.

### Circuit-Level

Full circuit-level noise including:

- Gate errors (depolarization)
- Measurement errors  
- Idling errors with T1/T2 decoherence
- Variable gate latencies

## Examples

### Generate Surface Code Dataset

```bash
# Circuit-level noise, distance 7, 0.1% error rate
python decoder_bench/generator.py --code=surface --basis=z --noise=circuit -d 7 -p 0.001 --records=100000

# Code capacity noise, distance 9, 0.09% error rate  
python decoder_bench/generator.py --code=surface --basis=x --noise=code_capacity -d 9 -p 0.0009 --records=50000
```

### Generate QLDPC Dataset

```bash
# QLDPC with phenomenological noise
python decoder_bench/generator.py --code=qldpc --basis=z --noise=phenom -d 12 -p 0.005 --records=25000
```

### Generate Color Code Dataset

```bash
# Color code with circuit-level noise (basis ignored)
python decoder_bench/generator.py --code=color --basis=z --noise=circuit -d 7 -p 0.003 --records=75000
```

### Lattice Surgery Simulation

```bash
# Lattice surgery with Z-basis logical operations
python decoder_bench/generator.py --code=ls --basis=z --noise=circuit -d 5 -p 0.001 --records=10000
```

### Batch Generation

Generate multiple datasets with different parameters:

```bash
#!/bin/bash
for d in 5 7 9; do
    for p in 0.001 0.003 0.005; do
        python decoder_bench/generator.py --code=surface --basis=z --noise=circuit -d $d -p $p --records=10000
    done
done
```

## Output Format

Datasets are saved as HDF5 files with the following structure:

- **Syndromes**: Binary syndrome measurements
- **Metadata**: Code parameters, noise model, simulation settings
- **Observables**: Logical measurement outcomes

## Using the datasets

Not all decoders are fast, which is why samplers like [Sinter](https://pypi.org/project/sinter/) are necessary for sampling millions of shots to compute useful statistics. Since Sinter does not support reading from decoder traces containing syndromes, this repository has a custom Sinter-like [sampler](./decoder_bench/sampler.py) to read from a trace dumped by decoder-bench. Refer to [eval.py](./decoder_bench/eval.py) and [decoders.py](./decoder_bench/decoders.py) for running your own evaluations and using different decoders. 

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Citation

If you use decoder-bench in your research, please cite:

```bibtex
@software{decoder_bench,
  title={decoder-bench: A Comprehensive Benchmarking Suite for Quantum Error Correction Decoders},
  author={Decoder Bench Contributors},
  url={https://github.com/yourusername/decoder-bench},
  year={2025}
}
```

## Credits

This tool uses code from the following repositories:

- [Stim](https://github.com/quantumlib/Stim)
- [SlidingWindowDecoder](https://github.com/gongaa/SlidingWindowDecoder)
- [honeycomb_threshold](https://github.com/Strilanc/honeycomb_threshold/tree/main/src)
- [BeliefMatching](https://github.com/oscarhiggott/BeliefMatching)
